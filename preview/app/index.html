<!DOCTYPE html>
<html lang="en" data-bg-image="assets/background.png">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="src/styles/shell.css" />
    <meta name="theme-color" content="#73C2FB" />
    <title>Letter Loom</title>
    <script>
      (() => {
        const cdnSrc =
          "https://cdn.jsdelivr.net/npm/@khmyznikov/pwa-install/dist/pwa-install.bundle.js";
        const localSrc = "assets/js/pwa-install.bundle.js";
        let resolveReady;
        window.pwaInstallReady = new Promise((res) => {
          resolveReady = res;
        });
        const load = (src) =>
          new Promise((resolve, reject) => {
            const s = document.createElement("script");
            s.src = src;
            s.defer = true;
            s.onload = () => resolve(src);
            s.onerror = () => reject(new Error(`Failed to load ${src}`));
            document.head.appendChild(s);
          });
        load(cdnSrc)
          .then((src) => resolveReady(src))
          .catch(() =>
            load(localSrc)
              .then((src) => resolveReady(src))
              .catch((err) => {
                console.warn("pwa-install script failed to load", err);
                resolveReady(null);
              })
          );
      })();
    </script>
  </head>
  <body>
    <!-- Asset loading: keep heavy images/media using data-src. The shell loader preloads them and assigns src to avoid broken placeholders during the splash. -->
    <pwa-install
      id="pwa-install"
      manifest-url="manifest.json"
    ></pwa-install>
    <div id="orientation-overlay">
      <div id="orientation-root" class="rootGameScreen">
        <div class="orientation-content">
          <img
            class="orientation-icon"
            data-src="assets/rotate-device-icon.png"
            alt="Rotate device icon"
          />
          <div id="orientation-message"></div>
        </div>
      </div>
    </div>
    <div id="game-root" class="rootGameScreen">
      <div class="game-content">
        <header class="game-header" id="gameHeader">
          <div class="brand-mark">LL</div>
          <div class="brand-name" id="appTitle">Letter Loom</div>
                    <div class="header-actions">
            <div class="lang-control" id="langControl">
              <button class="lang-btn" id="languageButton" aria-haspopup="true" aria-expanded="false">
                <span class="lang-icon"></span>
                <span id="languageCode">EN</span>
              </button>
              <select id="languageSelect" class="lang-select"></select>
              <div class="lang-dropdown" id="languageDropdown" hidden></div>
            </div>
            <button class="icon-btn" id="soundToggleBtn"></button>
          </div>
        </header>
        <main class="game-main" id="gameMain">
          <div class="screen splash-screen" id="screen-splash">
            <div class="splash-hero">
              <img
                id="splashLogo"
                class="splash-logo"
                src="assets/1x1-transparent.png"
                data-src="assets/logo-letters.png"
                alt="Letter Loom logo"
                draggable="false"
              />
            </div>
            <div class="splash-hero" id="splashLoadingBlock">
              
              <div class="splash-loader">
                <div class="loader-label">
                  <span id="splashLoaderLabel">Cargando...</span>
                  <span id="splashLoaderPercent">0%</span>
                </div>
                <div class="loader-bar">
                  <span id="splashLoaderProgress"></span>
                </div>
              </div>
            </div>

            <div class="splash-main hidden" id="splashMainContent">
              <div class="cta-stack">
                <button class="game-btn primary" id="splashContinueBtn"></button>
                <button class="game-btn ghost" id="resumeMatchBtn"></button>
                <button class="game-btn ghost" id="installAppBtn"></button>
              </div>
              <button class="link-btn" id="splashHelpBtn"></button>
            </div>
          </div>

          <div class="screen" id="screen-setup">
            <h2 id="setupTitle"></h2>
            <p id="setupSubtitle" class="lede"></p>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üë•</div>
                <h3 id="playersTitle"></h3>
              </div>
              <ul id="playerList" class="list"></ul>
              <button class="game-btn ghost" id="addPlayerBtn"></button>
            </div>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">‚è±Ô∏è</div>
                <h3 id="timersTitle"></h3>
              </div>
              <div class="field-row">
                <label for="strategyTimerInput" id="strategyTimerLabel"></label>
                <input type="number" id="strategyTimerInput" min="5" max="300" />
              </div>
              <div class="field-row">
                <label for="creationTimerInput" id="creationTimerLabel"></label>
                <input type="number" id="creationTimerInput" min="10" max="300" />
              </div>
            </div>
            <button class="game-btn primary" id="startGameBtn"></button>
          </div>

          <div class="screen" id="screen-live">
            <h2 id="liveTitle"></h2>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üïê</div>
                <h3 id="phaseTitle"></h3>
              </div>
              <div class="phase-block">
                <div class="phase-row" id="strategyPhaseRow">
                  <span id="strategyPhaseLabel"></span>
                  <span id="strategyTimerDisplay">00:30</span>
                </div>
                <div class="phase-row" id="creationPhaseRow">
                  <span id="creationPhaseLabel"></span>
                  <span id="creationTimerDisplay">01:00</span>
                </div>
                <div class="phase-actions">
                  <button class="game-btn ghost" id="startStrategyBtn"></button>
                  <button class="game-btn ghost" id="startCreationBtn"></button>
                </div>
              </div>
            </div>
            <button class="game-btn primary" id="goToScoringBtn"></button>
          </div>

          <div class="screen" id="screen-scoring">
            <h2 id="scoringTitle"></h2>
            <div id="scoringList" class="list"></div>
            <div class="card summary-card">
              <div id="scoringNote"></div>
              <button class="game-btn primary" id="saveBazaBtn"></button>
              <button class="game-btn ghost" id="editHistoryBtn"></button>
            </div>
          </div>

          <div class="screen" id="screen-history">
            <h2 id="historyTitle"></h2>
            <div id="historyList" class="list"></div>
            <button class="game-btn ghost" id="backToLiveBtn"></button>
          </div>
        </main>
        <footer class="game-footer" id="gameFooter"></footer>
      </div>
    </div>
    <video id="videoWakeLockWorkaround" loop muted playsinline>
      <source data-src="assets/empty-video.mp4" type="video/mp4" />
      <span id="video-fallback-text"></span>
    </video>
    <script type="module" src="./src/ui/shell/main.js"></script>
  </body>
</html>
