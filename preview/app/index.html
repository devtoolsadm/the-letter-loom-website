<!DOCTYPE html>
<html lang="en" data-bg-image="assets/img/background.png">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="src/styles/shell.css" />
    <link rel="stylesheet" href="src/styles/modal.css" />
    <meta name="theme-color" content="#73C2FB" />
    <title>Letter Loom</title>
    <script>
      (() => {
        const cdnSrc =
          "https://cdn.jsdelivr.net/npm/@khmyznikov/pwa-install/dist/pwa-install.bundle.js";
        const localSrc = "assets/js/pwa-install.bundle.js";
        let resolveReady;
        window.pwaInstallReady = new Promise((res) => {
          resolveReady = res;
        });
        const load = (src) =>
          new Promise((resolve, reject) => {
            const s = document.createElement("script");
            s.src = src;
            s.defer = true;
            s.onload = () => resolve(src);
            s.onerror = () => reject(new Error(`Failed to load ${src}`));
            document.head.appendChild(s);
          });
        load(cdnSrc)
          .then((src) => resolveReady(src))
          .catch(() =>
            load(localSrc)
              .then((src) => resolveReady(src))
              .catch((err) => {
                console.warn("pwa-install script failed to load", err);
                resolveReady(null);
              })
          );
      })();
    </script>
  </head>
  <body>
    <!-- Asset loading: keep heavy images/media using data-src. The shell loader preloads them and assigns src to avoid broken placeholders during the splash. -->
    <div id="orientation-overlay">
      <div id="orientation-root" class="rootGameScreen">
        <div class="orientation-content">
          <img
            class="orientation-icon"
            data-src="assets/img/rotate-device-icon.png"
            alt="Rotate device icon"
          />
          <div id="orientation-message"></div>
        </div>
      </div>
    </div>
    <div id="game-root" class="rootGameScreen">
      <pwa-install id="pwa-install" manifest-url="manifest.json"></pwa-install>
      <div class="game-content">
        <header class="game-header" id="gameHeader"></header>
        <main class="game-main" id="gameMain">
          <div class="screen splash-screen" id="screen-splash">
            <div class="splash-hero">
              <img
                id="splashLogo"
                class="splash-logo"
                src="assets/img/1x1-transparent.png"
                data-src="assets/img/logo-letters.png"
                alt="Letter Loom logo"
                draggable="false"
              />
            </div>
            <div class="splash-hero" id="splashLoadingBlock">
              
              <div class="splash-loader">
                <div class="loader-label">
                  <span id="splashLoaderLabel">Cargando...</span>
                  <span id="splashLoaderPercent">0%</span>
                </div>
                <div class="loader-bar">
                  <span id="splashLoaderProgress"></span>
                </div>
              </div>
            </div>

            <div class="splash-main hidden" id="splashMainContent">
              <div class="cta-stack">
                <button class="game-btn primary" id="splashContinueBtn"></button>
                <button class="game-btn ghost hidden" id="resumeMatchBtn"></button>
                <button class="game-btn btn-blue" id="installAppBtn"></button>
              </div>
              <div class="splash-actions">
                <button class="icon-btn glossy btn-yellow" type="button" id="settingsBtn" aria-label="Settings" data-modal-open="settings">
                  <span class="icon-btn-img icon-settings" aria-hidden="true"></span>
                </button>
                <button class="icon-btn glossy btn-yellow" type="button" id="buyBtn" aria-label="Buy" data-modal-open="support">
                  <span class="icon-btn-img icon-shop" aria-hidden="true"></span>
                </button>
                <button class="icon-btn glossy btn-yellow" type="button" id="helpBtn" aria-label="Help">
                  <span class="icon-btn-img icon-help" aria-hidden="true"></span>
                </button>
              </div>              
            </div>
          </div>

          <div class="screen pilot-screen" id="screen-pilot">

            <div class="pilot-top-row" id="pilotTopRow">
              <button class="icon-btn glossy btn-yellow pilot-back-btn" type="button" id="pilotBackBtn" aria-label="Back">
                <span class="icon-btn-img icon-prev" aria-hidden="true"></span>
              </button>
            </div>

            <div class="pilot-config" id="pilotConfigBlock">
              <div class="pilot-card">
                <div class="pilot-card-header" id="pilotConfigTitle"></div>
                <div class="pilot-row">
                  <div class="pilot-label" id="pilotStrategyLabel"></div>
                  <div class="pilot-controls">
                    <button class="icon-btn glossy gray pilot-ctrl pilot-ctrl-minus" type="button" id="pilotStrategyMinus" aria-label="-10s">
                      <span class="pilot-ctrl-text">-</span>
                    </button>
                    <div class="pilot-value" id="pilotStrategyValue">45s</div>
                    <button class="icon-btn glossy gray pilot-ctrl pilot-ctrl-plus" type="button" id="pilotStrategyPlus" aria-label="+10s">
                      <span class="pilot-ctrl-text">+</span>
                    </button>
                  </div>
                </div>
                <div class="pilot-row">
                  <div class="pilot-label" id="pilotCreationLabel"></div>
                  <div class="pilot-controls">
                    <button class="icon-btn glossy gray pilot-ctrl pilot-ctrl-minus" type="button" id="pilotCreationMinus" aria-label="-10s">
                      <span class="pilot-ctrl-text">-</span>
                    </button>
                    <div class="pilot-value" id="pilotCreationValue">70s</div>
                    <button class="icon-btn glossy gray pilot-ctrl pilot-ctrl-plus" type="button" id="pilotCreationPlus" aria-label="+10s">
                      <span class="pilot-ctrl-text">+</span>
                    </button>
                  </div>
                </div>
                <div class="pilot-actions">
                  <button class="game-btn primary" type="button" id="pilotStartMatchBtn"></button>
                </div>
              </div>
            </div>

            <div class="pilot-round-card hidden" id="pilotRoundCard">
              <div class="pilot-round-header" id="pilotRoundLabel"></div>
              <div class="pilot-timer-block">
                <div class="pilot-timer" id="pilotStrategyTimerCard">
                  <div class="pilot-timer-title" id="pilotStrategyTimerTitle"></div>
                  <div class="pilot-timer-value" id="pilotStrategyTimerValue">00:45</div>
                  <div class="pilot-timer-actions">
                    <button class="game-btn btn-blue" type="button" id="pilotStartStrategyBtn"></button>
                    <button class="game-btn btn-red hidden" type="button" id="pilotStrategyFinishBtn"></button>
                  </div>
                </div>
                <div class="pilot-timer" id="pilotCreationTimerCard">
                  <div class="pilot-timer-title" id="pilotCreationTimerTitle"></div>
                  <div class="pilot-timer-value" id="pilotCreationTimerValue">01:10</div>
                  <div class="pilot-timer-actions">
                    <button class="game-btn btn-blue" type="button" id="pilotStartCreationBtn"></button>
                    <button class="game-btn btn-red hidden" type="button" id="pilotCreationFinishBtn"></button>
                  </div>
                </div>
              </div>
              <div class="pilot-timeup-cta hidden" id="pilotCreationTimeupCta">
                <button class="game-btn btn-blue" type="button" id="pilotStartCreationCtaBtn"></button>
              </div>
              <div class="pilot-actions">
                <button class="game-btn btn-green" type="button" id="pilotNextRoundBtn"></button>
              </div>
            </div>

            <div class="pilot-exit-row">
              <button class="icon-btn glossy btn-yellow" type="button" id="pilotExitBtn" aria-label="Exit">
                <span class="icon-btn-img icon-exit" aria-hidden="true"></span>
              </button>
            </div>
          </div>

          <div class="screen" id="screen-setup">
            <h2 id="setupTitle"></h2>
            <p id="setupSubtitle" class="lede"></p>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üë•</div>
                <h3 id="playersTitle"></h3>
              </div>
              <ul id="playerList" class="list"></ul>
              <button class="game-btn ghost" id="addPlayerBtn"></button>
            </div>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">‚è±Ô∏è</div>
                <h3 id="timersTitle"></h3>
              </div>
              <div class="field-row">
                <label for="strategyTimerInput" id="strategyTimerLabel"></label>
                <input type="number" id="strategyTimerInput" min="5" max="300" />
              </div>
              <div class="field-row">
                <label for="creationTimerInput" id="creationTimerLabel"></label>
                <input type="number" id="creationTimerInput" min="10" max="300" />
              </div>
            </div>
            <button class="game-btn primary" id="startGameBtn"></button>
          </div>

          <div class="screen" id="screen-live">
            <h2 id="liveTitle"></h2>
            <div class="card">
              <div class="card-header">
                <div class="card-icon">üïê</div>
                <h3 id="phaseTitle"></h3>
              </div>
              <div class="phase-block">
                <div class="phase-row" id="strategyPhaseRow">
                  <span id="strategyPhaseLabel"></span>
                  <span id="strategyTimerDisplay">00:30</span>
                </div>
                <div class="phase-row" id="creationPhaseRow">
                  <span id="creationPhaseLabel"></span>
                  <span id="creationTimerDisplay">01:00</span>
                </div>
                <div class="phase-actions">
                  <button class="game-btn ghost" id="startStrategyBtn"></button>
                  <button class="game-btn ghost" id="startCreationBtn"></button>
                </div>
              </div>
            </div>
            <button class="game-btn primary" id="goToScoringBtn"></button>
          </div>

          <div class="screen" id="screen-scoring">
            <h2 id="scoringTitle"></h2>
            <div id="scoringList" class="list"></div>
            <div class="card summary-card">
              <div id="scoringNote"></div>
              <button class="game-btn primary" id="saveBazaBtn"></button>
              <button class="game-btn ghost" id="editHistoryBtn"></button>
            </div>
          </div>

          <div class="screen" id="screen-history">
            <h2 id="historyTitle"></h2>
            <div id="historyList" class="list"></div>
            <button class="game-btn ghost" id="backToLiveBtn"></button>
          </div>

        </main>
        <footer class="game-footer" id="gameFooter"></footer>
      </div>
      <!-- In-game modals (scaled with game root) -->
      <div class="modal-overlay" data-modal="settings" data-closable="1">
        <div class="frame-panel">
          <div class="modal-stitch"></div>
          <div class="modal-ribbon"><span id="settingsTitle"></span></div>
          <button class="modal-close" data-modal-close="settings" aria-label="Close"></button>
          <div class="modal-canvas">
            <div class="modal-content settings-list">
              <div class="settings-row">
                <div class="settings-label">
                  <span class="settings-icon sound" id="settingsSoundIcon" aria-hidden="true"></span>
                  <div id="settingsSoundLabel"></div>
                </div>
                <div class="settings-slider">
                  <input type="range" id="settingsSoundSlider" min="0" max="100" value="100" />
                  <span class="settings-value" id="settingsSoundValue">100%</span>
                </div>
              </div>
              <div class="settings-row">
                <div class="settings-label">
                  <span class="settings-icon music" id="settingsMusicIcon" aria-hidden="true"></span>
                  <div id="settingsMusicLabel"></div>
                </div>
                <div class="settings-slider">
                  <input type="range" id="settingsMusicSlider" min="0" max="100" value="100" />
                  <span class="settings-value" id="settingsMusicValue">100%</span>
                </div>
              </div>
              <div class="settings-row">
                <div class="settings-label">
                  <span class="settings-icon language" id="settingsLanguageIcon" aria-hidden="true"></span>
                  <label for="settingsLanguageSelect" id="settingsLanguageLabel"></label>
                </div>
                <div class="lang-control settings-lang-control" id="settingsLangControl">
                  <button class="lang-btn" type="button" id="settingsLanguageButton" aria-haspopup="true" aria-expanded="false">
                    <span id="settingsLanguageCode">EN</span>
                  </button>
                  <div class="lang-dropdown settings-lang-dropdown" id="settingsLanguageDropdown"></div>
                </div>
              </div>
              <div class="settings-actions">
                <button class="game-btn primary" type="button" id="settingsSaveBtn"></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-overlay" data-modal="support" data-closable="1">
        <div class="frame-panel">
          <div class="modal-stitch"></div>
          <div class="modal-ribbon"><span id="supportTitle"></span></div>
          <button class="modal-close" data-modal-close="support" aria-label="Close"></button>
          <div class="modal-canvas">
            <div class="modal-content">
              <p id="supportBody"></p>
              <div class="settings-actions">
                <button class="game-btn btn-yellow" type="button" id="supportCtaBtn"></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-overlay" data-modal="confirm" data-closable="1">
        <div class="frame-panel">
          <div class="modal-stitch"></div>
          <div class="modal-ribbon"><span id="confirmTitle"></span></div>
          <button class="modal-close" data-modal-close="confirm" aria-label="Close"></button>
          <div class="modal-canvas">
            <div class="modal-content">
              <p id="confirmBody"></p>
              <div class="settings-actions">
                <button class="game-btn ghost" type="button" id="confirmCancelBtn" data-modal-close="confirm"></button>
                <button class="game-btn primary" type="button" id="confirmAcceptBtn"></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-overlay" data-modal="manual" data-closable="1">
        <div class="frame-panel">
          <div class="modal-stitch"></div>
          <div class="modal-ribbon"><span id="manualTitle"></span></div>
          <button class="modal-close" data-modal-close="manual" aria-label="Close"></button>
          <div class="modal-canvas manual-canvas">
            <div class="modal-content manual-content">
              <iframe
                id="manualFrame"
                class="manual-frame"
                title="Game manual"
                data-manual-src="assets/doc/manual.pdf"
                loading="lazy"
              ></iframe>
              <div class="manual-actions">
                <button class="game-btn btn-blue" type="button" id="manualDownloadBtn"></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <video id="videoWakeLockWorkaround" loop muted playsinline>
      <source data-src="assets/img/empty-video.mp4" type="video/mp4" />
      <span id="video-fallback-text"></span>
    </video>

    <script type="module" src="./src/ui/shell/main.js"></script>
    <script type="module" src="./src/ui/shell/modal.js"></script>
  </body>
</html>
